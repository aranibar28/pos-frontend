<mat-card class="px-3">
  <mat-card-content>
     <div class="centered mb-2">
        <h1>MÃ³dulo de Compras</h1>
        <button (click)="open_table()" mat-raised-button color="primary">Lista de Compras</button>
     </div>
     <div class="row">
        <div class="col-md-12 d-flex gap-2">
           <mat-form-field appearance="fill">
              <mat-label>Proveedor</mat-label>
              <input matInput [formControl]="supplier" [matAutocomplete]="matSupplier">
              <button (click)="supplier.setValue('')" *ngIf="supplier.value" matSuffix mat-icon-button>
              <mat-icon fontIcon="close"></mat-icon>
              </button>
              <mat-autocomplete #matSupplier="matAutocomplete" [displayWith]="displayFn">
              <mat-option *ngFor="let item of suppliersOptions" [value]="item">{{ item.name }}</mat-option>
              </mat-autocomplete>
           </mat-form-field>
           <button (click)="create_supplier()" mat-mini-fab color="primary" class="mt-2">
              <mat-icon fontIcon="add"></mat-icon>
           </button>
        </div>
     </div>
     <mat-form-field appearance="fill">
        <mat-label>Buscar Producto</mat-label>
        <input matInput [formControl]="product" [matAutocomplete]="matProduct">
        <button (click)="product.setValue('')" *ngIf="product.value" matSuffix mat-icon-button>
        <mat-icon fontIcon="close"></mat-icon>
        </button>
        <mat-autocomplete #matProduct="matAutocomplete">
           <mat-option (click)="add_item(item)" *ngFor="let item of productsOptions" [value]="item">{{ item.title }} - {{ item.price | currency: 'PEN' }}</mat-option>
        </mat-autocomplete>
     </mat-form-field>
     <div class="table-responsive" style="height: 380px;">
        <table mat-table [dataSource]="dataSource">
           <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef> Producto </th>
              <td mat-cell *matCellDef="let element"> {{ element.title }} </td>
           </ng-container>
           <ng-container matColumnDef="price">
              <th mat-header-cell *matHeaderCellDef> Precio </th>
              <td mat-cell *matCellDef="let element"> {{ element.price | currency: 'PEN' }} </td>
           </ng-container>
           <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef> Ingreso </th>
              <td mat-cell *matCellDef="let element; let i = index">
                 <mat-form-field class="container-input">
                    <button (click)="decrease_qty(i)" mat-icon-button matPrefix>
                       <mat-icon>remove</mat-icon>
                    </button>
                    <input (keyup)="keyupQuantity($event, i)" [value]="element.quantity" type="number" matInput class="input-number mat-number"/>
                    <button (click)="increase_qty(i)" mat-icon-button matSuffix>
                       <mat-icon>add</mat-icon>
                    </button>
                 </mat-form-field>
              </td>
           </ng-container>
           <ng-container matColumnDef="subtotal">
              <th mat-header-cell *matHeaderCellDef> Subtotal </th>
              <td mat-cell *matCellDef="let element"> {{ element.quantity * element.price | currency: 'PEN' }} </td>
           </ng-container>
           <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> Actions </th>
              <td mat-cell *matCellDef="let element; let i = index">
                 <button (click)="del_item(i)" mat-mini-fab color="warn">
                    <mat-icon fontIcon="close"></mat-icon>
                 </button>
              </td>
           </ng-container>
           <ng-container>
              <tr *matNoDataRow>
                 <td class="text-center py-4" [attr.colspan]="displayedColumns.length">No has seleccionado productos.</td>
              </tr>
           </ng-container>
           <ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
           </ng-container>
        </table>
     </div>
     <ng-container>
      <div class="d-flex justify-content-around mt-3">
         <div>Productos: <span class="text-danger fw-bold">({{ count }})</span></div>
         <div>Total Pagar: <span class="text-success fw-bold">{{ total | currency: 'PEN' }}</span></div>
      </div>
      <button (click)="create_data()" [disabled]="loadButton" type="button" mat-raised-button color="primary">Comprar</button>
   </ng-container>
  </mat-card-content>
</mat-card>